<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Quest ‚Äì ‰∏≠Ëã±ÂçïËØçÁªÉ‰π†Ê∏∏Êàè</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        #app {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 500px;
            min-height: 600px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .screen {
            display: none;
            width: 100%;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .screen.active {
            display: flex;
        }

        h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 10px;
        }

        h2 {
            font-size: 22px;
            color: #555;
            margin-bottom: 20px;
        }

        .subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
        }

        .mode-btn {
            width: 100%;
            padding: 20px;
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .mode-btn:active {
            transform: translateY(0);
        }

        .mode-btn.eng-chi {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .mode-btn.chi-eng {
            background: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%);
            color: white;
        }

        .mode-btn.flashcard {
            background: linear-gradient(135deg, #5f2c82 0%, #49a09d 100%);
            color: white;
        }

        /* Quiz Screen Styles */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #11998e, #38ef7d);
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .score-display {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }

        .question-word {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            width: 100%;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .question-word:hover {
            transform: scale(1.02);
        }

        .question-word.speakable::after {
            content: ' üîä';
            font-size: 24px;
        }

        .answer-btn {
            width: 100%;
            padding: 18px;
            margin: 8px 0;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .answer-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .answer-btn.correct {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .answer-btn.wrong {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .answer-btn:disabled {
            cursor: not-allowed;
        }

        .feedback {
            font-size: 24px;
            margin: 20px 0;
            min-height: 40px;
        }

        /* Flashcard Styles */
        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            height: 250px;
            margin: 30px 0;
        }

        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-front,
        .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: bold;
            border-radius: 20px;
            padding: 20px;
        }

        .flashcard-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .flashcard-back {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            transform: rotateY(180deg);
        }

        .flashcard-nav {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .nav-btn {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn.prev {
            background: #6c757d;
            color: white;
        }

        .nav-btn.next {
            background: #007bff;
            color: white;
        }

        .nav-btn:hover {
            transform: scale(1.05);
        }

        .card-counter {
            font-size: 18px;
            color: #666;
            margin-top: 15px;
        }

        .tap-hint {
            font-size: 14px;
            color: #999;
            margin-top: 10px;
        }

        /* Results Screen */
        .result-score {
            font-size: 72px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
        }

        .result-text {
            font-size: 24px;
            color: #333;
            margin-bottom: 30px;
        }

        .result-message {
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .restart-btn {
            padding: 18px 40px;
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .restart-btn:hover {
            transform: scale(1.05);
        }

        .home-btn {
            margin-top: 15px;
            padding: 12px 30px;
            font-size: 16px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .home-btn:hover {
            background: #5a6268;
        }

        /* Responsive */
        @media (max-width: 480px) {
            #app {
                padding: 20px;
                min-height: auto;
            }

            h1 {
                font-size: 24px;
            }

            .question-word {
                font-size: 28px;
            }

            .flashcard-front,
            .flashcard-back {
                font-size: 26px;
            }

            .result-score {
                font-size: 56px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <h1>Vocabulary Quest</h1>
            <p class="subtitle">‰∏≠Ëã±ÂåªÂ≠¶ÂçïËØçÁªÉ‰π†Ê∏∏Êàè</p>
            <h2>ÈÄâÊã©Ê∏∏ÊàèÊ®°Âºè</h2>
            <button class="mode-btn eng-chi" onclick="startQuiz('eng-chi')">
                Mode A: English ‚Üí ‰∏≠Êñá
            </button>
            <button class="mode-btn chi-eng" onclick="startQuiz('chi-eng')">
                Mode B: ‰∏≠Êñá ‚Üí English
            </button>
            <button class="mode-btn flashcard" onclick="startFlashcards()">
                Mode C: Flashcards ÂçïËØçÂç°Áâá
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="screen">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="score-display">
                Score: <span id="score">0</span> / <span id="total">0</span>
            </div>
            <div class="question-word" id="question-word" onclick="speakQuestionWord()"></div>
            <div id="answers-container">
                <button class="answer-btn" onclick="checkAnswer(0)"></button>
                <button class="answer-btn" onclick="checkAnswer(1)"></button>
                <button class="answer-btn" onclick="checkAnswer(2)"></button>
                <button class="answer-btn" onclick="checkAnswer(3)"></button>
            </div>
            <div class="feedback" id="feedback"></div>
        </div>

        <!-- Flashcard Screen -->
        <div id="flashcard-screen" class="screen">
            <h2>Flashcards ÂçïËØçÂç°Áâá</h2>
            <div class="flashcard-container">
                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <div class="flashcard-front" id="card-front"></div>
                    <div class="flashcard-back" id="card-back"></div>
                </div>
            </div>
            <p class="tap-hint">ÁÇπÂáªÂç°ÁâáÁøªËΩ¨ / Tap to flip</p>
            <div class="card-counter">
                <span id="card-index">1</span> / <span id="card-total">100</span>
            </div>
            <div class="flashcard-nav">
                <button class="nav-btn prev" onclick="prevCard()">‚Üê Previous</button>
                <button class="nav-btn next" onclick="nextCard()">Next ‚Üí</button>
            </div>
            <button class="home-btn" onclick="goHome()">ËøîÂõû‰∏ªÈ°µ</button>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <h2>Game Over!</h2>
            <div class="result-score" id="final-score">0</div>
            <div class="result-text">out of 20 questions</div>
            <div class="result-message" id="result-message"></div>
            <button class="restart-btn" onclick="restartQuiz()">Play Again</button>
            <button class="home-btn" onclick="goHome()">ËøîÂõû‰∏ªÈ°µ</button>
        </div>
    </div>

    <script>
        // Medical vocabulary data - 100 terms
        const medicalWords = [
            { english: "hypertension", chinese: "È´òË°ÄÂéã" },
            { english: "diabetes", chinese: "Á≥ñÂ∞øÁóÖ" },
            { english: "pneumonia", chinese: "ËÇ∫ÁÇé" },
            { english: "bronchitis", chinese: "ÊîØÊ∞îÁÆ°ÁÇé" },
            { english: "arthritis", chinese: "ÂÖ≥ËäÇÁÇé" },
            { english: "anemia", chinese: "Ë¥´Ë°Ä" },
            { english: "asthma", chinese: "ÂìÆÂñò" },
            { english: "migraine", chinese: "ÂÅèÂ§¥Áóõ" },
            { english: "insomnia", chinese: "Â§±Áú†" },
            { english: "obesity", chinese: "ËÇ•ËÉñÁóá" },
            { english: "fracture", chinese: "È™®Êäò" },
            { english: "infection", chinese: "ÊÑüÊüì" },
            { english: "inflammation", chinese: "ÁÇéÁóá" },
            { english: "tumor", chinese: "ËÇøÁò§" },
            { english: "cancer", chinese: "ÁôåÁóá" },
            { english: "leukemia", chinese: "ÁôΩË°ÄÁóÖ" },
            { english: "hepatitis", chinese: "ËÇùÁÇé" },
            { english: "gastritis", chinese: "ËÉÉÁÇé" },
            { english: "appendicitis", chinese: "ÈòëÂ∞æÁÇé" },
            { english: "tonsillitis", chinese: "ÊâÅÊ°É‰ΩìÁÇé" },
            { english: "meningitis", chinese: "ËÑëËÜúÁÇé" },
            { english: "dermatitis", chinese: "ÁöÆÁÇé" },
            { english: "conjunctivitis", chinese: "ÁªìËÜúÁÇé" },
            { english: "otitis", chinese: "ËÄ≥ÁÇé" },
            { english: "sinusitis", chinese: "ÈºªÁ™¶ÁÇé" },
            { english: "pharyngitis", chinese: "ÂíΩÁÇé" },
            { english: "laryngitis", chinese: "ÂñâÁÇé" },
            { english: "nephritis", chinese: "ËÇæÁÇé" },
            { english: "cystitis", chinese: "ËÜÄËÉ±ÁÇé" },
            { english: "prostatitis", chinese: "ÂâçÂàóËÖ∫ÁÇé" },
            { english: "endometritis", chinese: "Â≠êÂÆ´ÂÜÖËÜúÁÇé" },
            { english: "mastitis", chinese: "‰π≥ËÖ∫ÁÇé" },
            { english: "pancreatitis", chinese: "ËÉ∞ËÖ∫ÁÇé" },
            { english: "cholecystitis", chinese: "ËÉÜÂõäÁÇé" },
            { english: "peritonitis", chinese: "ËÖπËÜúÁÇé" },
            { english: "myocarditis", chinese: "ÂøÉËÇåÁÇé" },
            { english: "pericarditis", chinese: "ÂøÉÂåÖÁÇé" },
            { english: "endocarditis", chinese: "ÂøÉÂÜÖËÜúÁÇé" },
            { english: "thrombosis", chinese: "Ë°ÄÊ†ìÂΩ¢Êàê" },
            { english: "embolism", chinese: "Ê†ìÂ°û" },
            { english: "hemorrhage", chinese: "Âá∫Ë°Ä" },
            { english: "edema", chinese: "Ê∞¥ËÇø" },
            { english: "necrosis", chinese: "ÂùèÊ≠ª" },
            { english: "fibrosis", chinese: "Á∫§Áª¥Âåñ" },
            { english: "cirrhosis", chinese: "ËÇùÁ°¨Âåñ" },
            { english: "atherosclerosis", chinese: "Âä®ËÑâÁ≤•Ê†∑Á°¨Âåñ" },
            { english: "osteoporosis", chinese: "È™®Ë¥®ÁñèÊùæÁóá" },
            { english: "scoliosis", chinese: "ËÑäÊü±‰æßÂºØ" },
            { english: "epilepsy", chinese: "Áô´Áó´" },
            { english: "paralysis", chinese: "Áò´Áó™" },
            { english: "stroke", chinese: "‰∏≠È£é" },
            { english: "concussion", chinese: "ËÑëÈúáËç°" },
            { english: "hernia", chinese: "ÁñùÊ∞î" },
            { english: "ulcer", chinese: "Ê∫ÉÁñ°" },
            { english: "abscess", chinese: "ËÑìËÇø" },
            { english: "cyst", chinese: "ÂõäËÇø" },
            { english: "polyp", chinese: "ÊÅØËÇâ" },
            { english: "nodule", chinese: "ÁªìËäÇ" },
            { english: "lesion", chinese: "ÁóÖÂèò" },
            { english: "symptom", chinese: "ÁóáÁä∂" },
            { english: "diagnosis", chinese: "ËØäÊñ≠" },
            { english: "prognosis", chinese: "È¢ÑÂêé" },
            { english: "therapy", chinese: "Ê≤ªÁñó" },
            { english: "surgery", chinese: "ÊâãÊúØ" },
            { english: "biopsy", chinese: "Ê¥ªÊ£Ä" },
            { english: "autopsy", chinese: "Â∞∏Ê£Ä" },
            { english: "prescription", chinese: "Â§ÑÊñπ" },
            { english: "dosage", chinese: "ÂâÇÈáè" },
            { english: "injection", chinese: "Ê≥®Â∞Ñ" },
            { english: "infusion", chinese: "ËæìÊ∂≤" },
            { english: "transfusion", chinese: "ËæìË°Ä" },
            { english: "anesthesia", chinese: "È∫ªÈÜâ" },
            { english: "antibiotic", chinese: "ÊäóÁîüÁ¥†" },
            { english: "vaccine", chinese: "Áñ´Ëãó" },
            { english: "immunity", chinese: "ÂÖçÁñ´Âäõ" },
            { english: "allergy", chinese: "ËøáÊïè" },
            { english: "metabolism", chinese: "Êñ∞Èôà‰ª£Ë∞¢" },
            { english: "hormone", chinese: "ÊøÄÁ¥†" },
            { english: "enzyme", chinese: "ÈÖ∂" },
            { english: "protein", chinese: "ËõãÁôΩË¥®" },
            { english: "carbohydrate", chinese: "Á¢≥Ê∞¥ÂåñÂêàÁâ©" },
            { english: "cholesterol", chinese: "ËÉÜÂõ∫ÈÜá" },
            { english: "glucose", chinese: "Ëë°ËêÑÁ≥ñ" },
            { english: "hemoglobin", chinese: "Ë°ÄÁ∫¢ËõãÁôΩ" },
            { english: "platelet", chinese: "Ë°ÄÂ∞èÊùø" },
            { english: "leukocyte", chinese: "ÁôΩÁªÜËÉû" },
            { english: "erythrocyte", chinese: "Á∫¢ÁªÜËÉû" },
            { english: "artery", chinese: "Âä®ËÑâ" },
            { english: "vein", chinese: "ÈùôËÑâ" },
            { english: "capillary", chinese: "ÊØõÁªÜË°ÄÁÆ°" },
            { english: "nerve", chinese: "Á•ûÁªè" },
            { english: "muscle", chinese: "ËÇåËÇâ" },
            { english: "tendon", chinese: "ËÇåËÖ±" },
            { english: "ligament", chinese: "ÈüßÂ∏¶" },
            { english: "cartilage", chinese: "ËΩØÈ™®" },
            { english: "bone marrow", chinese: "È™®È´ì" },
            { english: "spleen", chinese: "ËÑæËÑè" },
            { english: "thyroid", chinese: "Áî≤Áä∂ËÖ∫" },
            { english: "adrenal gland", chinese: "ËÇæ‰∏äËÖ∫" },
            { english: "pituitary gland", chinese: "ÂûÇ‰Ωì" }
        ];

        // Game state
        let currentMode = '';
        let currentQuestionIndex = 0;
        let score = 0;
        let totalQuestions = 20;
        let currentAnswers = [];
        let correctAnswerIndex = 0;
        let shuffledWords = [];
        let currentCardIndex = 0;
        let isAnswered = false;
        let speechEnabled = false;
        let pendingSpeech = null;

        // Initialize speech synthesis after user interaction
        function initSpeech() {
            if (!speechEnabled && 'speechSynthesis' in window) {
                // Unlock audio context with a silent utterance
                const unlock = new SpeechSynthesisUtterance('');
                unlock.volume = 0;
                window.speechSynthesis.speak(unlock);
                speechEnabled = true;

                // Speak any pending word
                if (pendingSpeech) {
                    setTimeout(() => {
                        speakWord(pendingSpeech);
                        pendingSpeech = null;
                    }, 100);
                }
            }
        }

        // Speech synthesis function
        function speakWord(text) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();

                // If speech not yet enabled, queue it
                if (!speechEnabled) {
                    pendingSpeech = text;
                    return;
                }

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                utterance.pitch = 1;

                // Fix for some browsers where voices aren't loaded yet
                const voices = window.speechSynthesis.getVoices();
                const englishVoice = voices.find(v => v.lang.startsWith('en'));
                if (englishVoice) {
                    utterance.voice = englishVoice;
                }

                window.speechSynthesis.speak(utterance);
            }
        }

        // Preload voices when available
        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = function() {
                window.speechSynthesis.getVoices();
            };
        }

        // Speak current question word (for clicking on question in quiz mode)
        function speakQuestionWord() {
            if (currentMode === 'eng-chi' && shuffledWords[currentQuestionIndex]) {
                speakWord(shuffledWords[currentQuestionIndex].english);
            }
        }

        // Utility functions
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Quiz functions
        function startQuiz(mode) {
            // Initialize speech on user interaction (button click)
            initSpeech();

            currentMode = mode;
            currentQuestionIndex = 0;
            score = 0;
            shuffledWords = shuffleArray(medicalWords).slice(0, totalQuestions);

            document.getElementById('score').textContent = '0';
            document.getElementById('total').textContent = '0';
            document.getElementById('feedback').textContent = '';

            showScreen('quiz-screen');

            // Small delay to ensure speech is initialized before first word
            setTimeout(() => {
                loadQuestion();
            }, 150);
        }

        function loadQuestion() {
            if (currentQuestionIndex >= totalQuestions) {
                showResults();
                return;
            }

            isAnswered = false;
            const currentWord = shuffledWords[currentQuestionIndex];

            // Update progress
            const progress = ((currentQuestionIndex) / totalQuestions) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';

            // Set question word
            const questionWord = currentMode === 'eng-chi' ? currentWord.english : currentWord.chinese;
            document.getElementById('question-word').textContent = questionWord;

            // Add speakable class and speak the word if it's English (Mode A: English ‚Üí Chinese)
            const questionWordEl = document.getElementById('question-word');
            if (currentMode === 'eng-chi') {
                questionWordEl.classList.add('speakable');
                speakWord(currentWord.english);
            } else {
                questionWordEl.classList.remove('speakable');
            }

            // Generate answer choices
            const correctAnswer = currentMode === 'eng-chi' ? currentWord.chinese : currentWord.english;

            // Get 3 random wrong answers
            let wrongAnswers = medicalWords
                .filter(w => w !== currentWord)
                .sort(() => Math.random() - 0.5)
                .slice(0, 3)
                .map(w => currentMode === 'eng-chi' ? w.chinese : w.english);

            // Combine and shuffle answers
            currentAnswers = shuffleArray([correctAnswer, ...wrongAnswers]);
            correctAnswerIndex = currentAnswers.indexOf(correctAnswer);

            // Update answer buttons
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach((btn, index) => {
                btn.textContent = currentAnswers[index];
                btn.className = 'answer-btn';
                btn.disabled = false;
            });

            document.getElementById('feedback').textContent = '';
        }

        function checkAnswer(selectedIndex) {
            if (isAnswered) return;
            isAnswered = true;

            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach(btn => btn.disabled = true);

            // Speak the selected answer if it's English (Mode B: Chinese ‚Üí English)
            if (currentMode === 'chi-eng') {
                speakWord(currentAnswers[selectedIndex]);
            }

            if (selectedIndex === correctAnswerIndex) {
                score++;
                document.getElementById('score').textContent = score;
                buttons[selectedIndex].classList.add('correct');
                document.getElementById('feedback').textContent = 'Correct! üéâ';
            } else {
                buttons[selectedIndex].classList.add('wrong');
                buttons[correctAnswerIndex].classList.add('correct');
                document.getElementById('feedback').textContent = 'Wrong ‚ùå';
            }

            document.getElementById('total').textContent = currentQuestionIndex + 1;

            // Load next question after delay
            setTimeout(() => {
                currentQuestionIndex++;
                loadQuestion();
            }, 1500);
        }

        function showResults() {
            document.getElementById('final-score').textContent = score;

            let message = '';
            const percentage = (score / totalQuestions) * 100;

            if (percentage === 100) {
                message = 'üèÜ Perfect! Â§™Ê£í‰∫ÜÔºÅYou are a vocabulary master!';
            } else if (percentage >= 80) {
                message = 'üåü Excellent! ÈùûÂ∏∏Â•ΩÔºÅKeep up the great work!';
            } else if (percentage >= 60) {
                message = 'üëç Good job! ‰∏çÈîôÔºÅKeep practicing!';
            } else if (percentage >= 40) {
                message = 'üí™ Keep trying! ÁªßÁª≠Âä™ÂäõÔºÅYou can do better!';
            } else {
                message = 'üìö Time to study! Âä†Ê≤πÂ≠¶‰π†ÔºÅPractice makes perfect!';
            }

            document.getElementById('result-message').textContent = message;
            showScreen('results-screen');
        }

        function restartQuiz() {
            startQuiz(currentMode);
        }

        // Flashcard functions
        function startFlashcards() {
            // Initialize speech on user interaction (button click)
            initSpeech();

            shuffledWords = shuffleArray(medicalWords);
            currentCardIndex = 0;
            document.getElementById('card-total').textContent = medicalWords.length;
            showScreen('flashcard-screen');
            updateFlashcard();
        }

        function updateFlashcard() {
            const card = shuffledWords[currentCardIndex];
            document.getElementById('card-front').textContent = card.english;
            document.getElementById('card-back').textContent = card.chinese;
            document.getElementById('card-index').textContent = currentCardIndex + 1;

            // Reset flip state
            document.getElementById('flashcard').classList.remove('flipped');
        }

        function flipCard() {
            const flashcard = document.getElementById('flashcard');
            const isCurrentlyFlipped = flashcard.classList.contains('flipped');

            // Speak the English word when clicking (before flipping to Chinese)
            if (!isCurrentlyFlipped) {
                speakWord(shuffledWords[currentCardIndex].english);
            }

            flashcard.classList.toggle('flipped');
        }

        function nextCard() {
            currentCardIndex = (currentCardIndex + 1) % shuffledWords.length;
            updateFlashcard();
        }

        function prevCard() {
            currentCardIndex = (currentCardIndex - 1 + shuffledWords.length) % shuffledWords.length;
            updateFlashcard();
        }

        function goHome() {
            showScreen('start-screen');
        }
    </script>
</body>
</html>
